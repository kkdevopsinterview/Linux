## 1) You accidentally deleted an important file. How would you recover it in Linux?

### Scenario
An application log/config was deleted from an ext4 filesystem. No recent backup exists.

### Key Facts
- On **ext4/XFS**, `rm` drops directory entries and decrements inode links; data blocks may still be on disk until overwritten.
- Recovery chances drop rapidly if the filesystem stays mounted and continues writing.

### Immediate Actions (Increase Success Probability)
1. Stop writes to that filesystem:
   ```bash
   sync
   mount | grep ' /data '   # identify mount
   sudo umount /data        # if possible
````

If unmounting isn’t feasible (root FS), remount read-only:

```bash
sudo mount -o remount,ro /
```

2. Capture disk image (attempt recovery offline):

   ```bash
   sudo dd if=/dev/sdX of=/mnt/recovery/disk.img bs=4M conv=sync,noerror status=progress
   ```

### Recovery Approaches

* **extundelete (ext3/ext4 only, needs unmounted FS or image):**

  ```bash
  sudo extundelete /dev/sdX --restore-file /path/to/important.conf
  sudo extundelete /dev/sdX --restore-directory /path/to/dir
  ```
* **testdisk/photorec (file-carving; header-based):**

  ```bash
  sudo photorec
  ```
* **LVM snapshots (if preconfigured):**

  ```bash
  lvcreate -s -n rec_snap -L 5G /dev/vg/lvdata
  mount /dev/vg/rec_snap /mnt/snap
  cp /mnt/snap/important.conf /restore/
  ```

### If It Was Still Open by a Process (common for logs)

```bash
# Find the process with the deleted file
sudo lsof | grep '(deleted)' | grep important.log
# Suppose PID=1234 and fd=4:
sudo cat /proc/1234/fd/4 > /tmp/important.log.recovered
```

### Preventive Controls

* Rotate and ship logs to remote (rsyslog/Fluent Bit).
* Use snapshots (LVM, ZFS, btrfs) and backups (Borg/Restic).

### Interview Angle

Freeze writes → snapshot/image → file-system-aware tools (extundelete) → generic carving (photorec) → `/proc/<pid>/fd` for open files.

---

## 2) A user reports they cannot access a file even though they have read permissions. What could be the issue?

### Common Root Causes

1. **Parent directory execute (search) bit missing** — need `x` on all parent dirs.
2. **ACLs** override standard perms.
3. **SELinux/AppArmor** policy denial.
4. **Mount options** like `noexec` (affects execution; reading usually OK).
5. **NFS UID/GID mismatch or root_squash**.

### Systematic Checks

```bash
# Path traversal permissions
namei -l /path/to/file

# ACLs
getfacl /path/to/file
getfacl /path/to/parent

# SELinux/AppArmor
ls -Z /path/to/file
sudo ausearch -m avc -ts recent | less
aa-status

# NFS mapping & mount opts
mount | grep nfs
id username
```

### Fix Examples

```bash
chmod o+x /path/to                 # add execute on parent dir
setfacl -m u:student:r /path/to/file
sudo restorecon -Rv /path/to       # fix SELinux context
```

### Interview Angle

Directory **execute bit** for traversal and **ACL/SELinux** as invisible blockers.

---

## 3) You need to find and delete all log files older than 30 days.

### Command (with dry run first)

```bash
find /var/log -type f -name '*.log' -mtime +30 -print
find /var/log -type f -name '*.log' -mtime +30 -delete
```

### Include compressed logs and systemd journal

```bash
find /var/log -type f \( -name '*.log' -o -name '*.gz' \) -mtime +30 -delete
sudo journalctl --vacuum-time=30d
```

### Interview Angle

Always **dry run** and handle **journald** separately.

---

## 4) A directory has thousands of files, and `rm -rf` is taking too long. How can you speed it up?

### Techniques

* **rsync delete trick**:

  ```bash
  mkdir -p /empty && rsync -a --delete /empty/ /bigdir/
  rmdir /empty
  ```
* **find with -delete** (no argv blowups):

  ```bash
  find /bigdir -type f -delete
  find /bigdir -type d -empty -delete
  ```
* **Parallel xargs**:

  ```bash
  find /bigdir -type f -print0 | xargs -0 -P 8 rm -f
  ```
* **Subvolume delete (btrfs)**:

  ```bash
  btrfs subvolume delete /bigdir
  ```

### Interview Angle

Batch syscalls, avoid shell glob expansion, exploit FS primitives (subvolume).

---

## 5) How do you find the top 10 largest files on your Linux system?

### Whole system (single filesystem)

```bash
sudo find / -xdev -type f -printf '%s %p\n' 2>/dev/null | sort -nr | head -n 10
```

### Specific path

```bash
find /var -type f -printf '%s %p\n' 2>/dev/null | sort -nr | head -n 10
```

### Interview Angle

Use `-xdev` to stay on the same filesystem and `-printf` for speed.

---

## 6) A script is failing with "permission denied", even as root. What could be the reason?

### Likely Causes & Fixes

* **No execute bit**:

  ```bash
  chmod +x script.sh
  ```
* **Wrong shebang / CRLF endings**:

  ```bash
  head -1 script.sh
  file script.sh
  dos2unix script.sh
  ```
* **`noexec` mount**:

  ```bash
  mount | grep noexec
  # Move to exec-enabled FS or remount appropriately
  ```
* **SELinux denial**:

  ```bash
  restorecon -Rv /path/to/script
  sudo ausearch -m avc -ts recent | less
  ```
* **Missing interpreter**:

  ```bash
  which bash python perl
  ```

### Interview Angle

Check **perms → line endings → mount → SELinux → interpreter**.

---

## 7) You need to rename multiple files that have spaces in their names.

### Safe loop (handles special chars)

```bash
find . -maxdepth 1 -type f -name '* *' -print0 \
| while IFS= read -r -d '' f; do
  mv -i "$f" "${f// /_}"
done
```

### Using `rename`

```bash
# Debian/Ubuntu (perl rename)
rename 's/ /_/g' *\ *

# util-linux variant (Fedora/RHEL)
rename ' ' '_' -- *\ *
```

### Interview Angle

Use **null-delimited** pipelines and **quoting**.

---

## 8) How do you compare two directories and find the differences in files?

### Quick summary

```bash
diff -rq dirA dirB
```

### Show content diffs

```bash
diff -ruN dirA dirB | less
```

### Hash-based verification

```bash
( cd dirA && find . -type f -print0 | sort -z | xargs -0 md5sum ) > /tmp/a.md5
( cd dirB && find . -type f -print0 | sort -z | xargs -0 md5sum ) > /tmp/b.md5
diff -u /tmp/a.md5 /tmp/b.md5
```

### Interview Angle

Choose **metadata vs content** comparison per need; hashing is costlier but exact.

---

## 9) A user is unable to create files in a directory, but `ls -l` shows they have write permission. What could be the problem?

### Hidden Causes & Checks

* **Missing execute bit on directory** (need `wx` to create, `x` to traverse):

  ```bash
  chmod u+rwx /shared/dir
  ```
* **Filesystem full / no inodes**:

  ```bash
  df -h
  df -i
  ```
* **ACL denies write**:

  ```bash
  getfacl /shared/dir
  ```
* **Immutable attribute**:

  ```bash
  lsattr /shared/dir
  chattr -i /shared/dir
  ```
* **Quota exceeded**:

  ```bash
  quota -u username
  ```

### Interview Angle

Call out **inode exhaustion** and **directory execute bit** first.

---

## 10) A symbolic link you created is broken. How do you troubleshoot and fix it?

### Diagnose

```bash
ls -l linkname
readlink -f linkname
file linkname
```

* Does the target exist?
* Was it a **relative** link that broke after moving directories?
* Are permissions/SELinux context correct?

### Fix Patterns

```bash
ln -sfn /correct/absolute/path target_link     # recreate safely (force)
ln -s ../shared/config.yaml app/config.yaml    # prefer relative within trees
restorecon -Rv /path/to/target /path/to/link   # fix SELinux if needed
```

### Preventive Practice

* Use **absolute** symlinks for system paths; **relative** within relocatable app trees.
* CI check for dangling links:

  ```bash
  find . -type l ! -exec test -e {} \; -print
  ```

---

## Appendices

### Useful One-Liners

```bash
# Count files quickly in a directory
find /path -type f -printf '.' | wc -c

# Remove only empty directories
find /path -type d -empty -delete
```

### Operational Guardrails

* Always dry-run destructive `find -delete` with `-print` first.
* Exclude pseudo filesystems when scanning from `/`:

  ```bash
  find / -xdev -type f ...
  ```

### Storyline Template for Interviews

* **Situation** → what broke (file deleted / perms / scale).
* **Investigation** → exact commands you ran.
* **Root Cause** → specific bit/ACL/policy/mount option.
* **Fix** → precise command and verification.
* **Prevention** → snapshotting, backups, CI checks, policies.


```
